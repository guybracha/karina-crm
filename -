import { createBrowserRouter, RouterProvider } from "react-router-dom";
import Navbar from "./Navbar.jsx";
import Dashboard from "../pages/Dashboard.jsx";
import CustomersList from "../features/customers/CustomersList.jsx";
import CustomerDetails from "../features/customers/CustomerDetails.jsx";
import NotFound from "../pages/NotFound.jsx";
import NotFound from "../pages/NotFound.jsx";
import Pipeline from "../features/pipeline/Pipeline.jsx";
import AuthGate from "../auth/authGate.jsx";
import Pipeline from "../features/pipeline/Pipeline.jsx";

function Shell({ children }) {
  return (
    <div className="container py-4">
      <Navbar />
      {children}
    </div>
  );
}


const requireAuth = String(import.meta.env.VITE_REQUIRE_AUTH || ').toLowerCase() === 'true';

function Page(el) {
  return (
    <Shell>
      {requireAuth ? <AuthGate>{el}</AuthGate> : el}
    </Shell>
  );
}

const router = createBrowserRouter([
  { path: "/", element: Page(<Dashboard />) },
  { path: "/customers", element: Page(<CustomersList />) },
  { path: "/customers/:id", element: Page(<CustomerDetails />) }, // ⬅️ חדש
  { path: "/pipeline", element: Page(<Pipeline />) },
  { path: "*", element: Page(<NotFound />) },
]);

export default function AppRouter() {
  return <RouterProvider router={router} />;
}
